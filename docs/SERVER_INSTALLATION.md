# UORespawn Server Installation Guide

## Overview

UORespawn is a player-centric spawn system for ServUO where **players become the spawners**. Instead of placing XML spawners throughout the world, UORespawn dynamically spawns creatures around players based on their location, terrain, and nearby static objects.

### How It Works

1. **Editor App** (this application) - Create spawn configurations
2. **Server Scripts** - Read the configurations and spawn creatures around players
3. **Dynamic Spawning** - Creatures spawn/despawn as players move through the world

---

## Server-Side Installation

### Step 1: Copy Server Scripts

Copy the entire `SpawnSystem` folder to your ServUO `Scripts/Custom/` directory:

```
ServUO/
??? Scripts/
    ??? Custom/
        ??? SpawnSystem/          ? Copy this entire folder
            ??? Commands/
            ??? Entity/
            ??? Items/
            ??? Mobiles/
            ?   ??? EffectNPCs/
            ?   ??? WorldNPCs/
            ?   ??? Utility/
            ??? SpawnWorkers/
            ??? SpawnSysCommands.cs
            ??? SpawnSysCore.cs
            ??? SpawnSysDataBase.cs
            ??? SpawnSysFactory.cs
            ??? SpawnSysSettings.cs
            ??? SpawnSysTileInfo.cs
            ??? SpawnSysTimer.cs
            ??? SpawnSysUtility.cs
```

**Source Location:**  
The `SpawnSystem` folder is included in the UORespawn Editor application at:  
`UORespawnApp\SpawnSystem\`

### Step 2: Compile ServUO

1. Open your ServUO solution in Visual Studio
2. Build the solution (Ctrl+Shift+B)
3. Fix any compilation errors (if any)
4. The UORespawn system will automatically initialize on server startup

### Step 3: Verify Installation

1. Start your ServUO server
2. Look for UORespawn initialization messages in the console:
   ```
   *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*
   |-|-|-|-|-|-|-| UORespawn |-|-|-|-|-|-|-|
   |-|-|-|-|-|-|-|   ~*~*~   |-|-|-|-|-|-|-|
   *~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*
   Lists Initialized...
   Events Subscribed...
   Timer Activated...
   Dynamic Spawner Running...
   ```

---

## Data Files

UORespawn requires data files created by the editor. These files should be placed in your `ServUO\Data\` folder:

### Required Files

| File | Description | Created By |
|------|-------------|------------|
| `UOR_Spawn.csv` | Map spawn boxes (manual placements) | Map Spawn Editor |
| `UOR_WorldSpawn.csv` | World tile spawns (automatic) | World Spawn Editor |
| `UOR_StaticSpawn.csv` | Static object spawns | Static Spawn Editor |
| `UOR_SpawnSettings.csv` | Spawn system settings | Settings Panel |
| `UOR_BestiaryList.txt` | Available creatures | Generated by command |
| `UOR_StaticList.txt` | Available static items | Generated by command |
| `UOR_SpawnerList.txt` | XML spawner locations | Generated by command |

### Auto-Sync (Windows/macOS)

The editor can automatically sync these files:
1. Go to **Settings** in the editor
2. Click **Browse** under "Server Integration"
3. Select your `ServUO\Data\` folder
4. Files will auto-save to both locations

### Manual Sync (All Platforms)

Copy files from:
```
UORespawnApp\Data\
```

To:
```
ServUO\Data\
```

---

## In-Game Commands

All commands require **Administrator** access level.

### Core Commands

#### `[PushRespawn]`
**Purpose:** Manually trigger spawn update for all online players  
**Usage:** `[PushRespawn`  
**When to use:** Testing spawn configurations, forcing immediate spawns

#### `[ReloadRespawn]`
**Purpose:** Reload all spawn data files without restarting server  
**Usage:** `[ReloadRespawn`  
**When to use:** After updating spawn files with the editor

#### `[DebugRespawn]`
**Purpose:** Toggle debug mode (spawns placeholders for testing)  
**Usage:** `[DebugRespawn`  
**Effect:** Shows "PlaceHolder" mobs instead of real creatures  
**When to use:** Testing spawn locations without real mobs

### Tracking Commands

#### `[TrackRespawn]`
**Purpose:** View statistics about spawned creatures  
**Usage:** `[TrackRespawn`  
**Output:**
```
===== UORespawn Tracking Statistics =====
Total Tracked: 1,234
Valid Spawns: 1,180
Tamed/Stabled: 45
Deleted/Invalid: 9
=========================================
```

#### `[ClearRespawn]`
**Purpose:** Delete all UORespawn creatures and clear tracking  
**Usage:** `[ClearRespawn`  
**Warning:** ?? This deletes ALL spawned creatures (except tamed)  
**When to use:** Server maintenance, testing, or spawn system reset

### File Generation Commands

These commands generate files for the editor:

#### `[GenRespawnList]`
**Purpose:** Generate bestiary list of all spawnable creatures  
**Usage:** `[GenRespawnList`  
**Output:** `Data\UOR_BestiaryList.txt`  
**Contains:** All BaseCreature classes with parameterless constructors

#### `[GenStaticList]`
**Purpose:** Generate list of all static items in tile data  
**Usage:** `[GenStaticList`  
**Output:** `Data\UOR_StaticList.txt`  
**Contains:** All static item names from TileData

#### `[GenSpawnerList]`
**Purpose:** Generate list of existing XML spawner locations  
**Usage:** `[GenSpawnerList`  
**Output:** `Data\UOR_SpawnerList.txt`  
**Contains:** Map, X, Y, and Range of all Spawner/XmlSpawner items  
**Format:** `MapName:X:Y:Range`

#### `[PushRespawnStats]`
**Purpose:** Force save spawn statistics to disk  
**Usage:** `[PushRespawnStats`  
**Output:** `Data\UOR_Stats\YYYY_DDD.txt`  
**Contains:** Spawn history for heatmap visualization

---

## Workflow: Editor ? Server

### Initial Setup

1. **Install Server Scripts**
   - Copy `SpawnSystem` folder to `Scripts/Custom/`
   - Compile and start server

2. **Generate Lists** (one-time)
   ```
   [GenRespawnList    // Creates bestiary
   [GenStaticList     // Creates static list
   [GenSpawnerList    // Creates XML spawner list
   ```

3. **Configure Editor**
   - Point editor to `ServUO\Data\` folder
   - Files will auto-sync

### Creating Spawns

1. **Use Editor** to create spawn configurations
2. **Files Auto-Save** to `ServUO\Data\`
3. **In-Game:** `[ReloadRespawn` to load new configs
4. **Test:** Walk around, spawns appear automatically

### Testing & Debugging

1. Enable debug mode: `[DebugRespawn`
2. Walk around to see placeholders
3. Check spawn coverage and density
4. Disable debug: `[DebugRespawn`
5. Reload real spawns: `[ReloadRespawn`

### Monitoring

- Use `[TrackRespawn` to see active spawn counts
- Check `Data\UOR_Stats\` for spawn history
- Use editor's heatmap to visualize spawn distribution

---

## Spawn System Mechanics

### How Spawning Works

1. **Player Movement** triggers spawn evaluation
2. **System Checks:**
   - Player location and map
   - Nearby spawn boxes (Map Spawns)
   - Current terrain tile (World Spawns)
   - Nearby static items (Static Spawns)
   - Current weather (Weather Spawns)
   - Water tiles (Water Spawns)

3. **Spawn Queue** fills with potential spawns
4. **Timer** spawns creatures from queue gradually
5. **Cleanup** removes creatures when players move away

### Spawn Priority

Spawns are evaluated in this order:
1. Map Spawn boxes (manual)
2. Weather conditions
3. Water tiles
4. Terrain tiles (World Spawn)
5. Static objects (Static Spawn)

### Spawn Range

- **MinRange:** 10 tiles (creatures won't spawn closer)
- **MaxRange:** 50 tiles (creatures spawn within this distance)
- **Cleanup:** 1.5× MaxRange (creatures delete when too far)

### Performance

- **Tracked Spawns:** System tracks all spawned creatures
- **Auto-Cleanup:** Removes creatures far from players
- **Crowd Control:** Limits spawns per area
- **Scale Spawn:** Optional player count multiplier

---

## Compatibility with XML Spawners

UORespawn works **alongside** XML spawners:

- **XML Spawners:** Static spawn points you place manually
- **UORespawn:** Dynamic spawns around players

### Why Use Both?

- **XML Spawners:** Boss rooms, quest NPCs, town guards
- **UORespawn:** Wilderness, dungeons, random encounters

### Viewing XML Spawners in Editor

The editor shows XML spawner locations:
1. Open Map Spawn view
2. Toggle **XML** button (green = on)
3. See green boxes showing spawner ranges
4. Place UORespawn boxes to complement (not overlap)

---

## Troubleshooting

### Spawns Not Appearing

**Check:**
1. Files in `ServUO\Data\` folder?
2. Used `[ReloadRespawn` after file changes?
3. Player in correct map?
4. Debug mode enabled? (disable it)

**Console Message:**
```
Loading Spawn Data Error: [message]
Loading World Spawn Error: [message]
Loading Static Spawn Error: [message]
```

### Too Many Spawns

**Solutions:**
1. Reduce `MaxMobs` in Settings
2. Increase `MinRange` in Settings
3. Lower spawn chances (Common/Uncommon/Rare)
4. Use `[ClearRespawn` to reset

### Files Not Syncing

**Windows/macOS:**
- Check Settings ? Server Integration path
- Ensure folder has write permissions

**Other Platforms:**
- Use manual copy from `UORespawnApp\Data\` to `ServUO\Data\`

### Version Mismatch

Console shows:
```
Update Needed => Update Scripts!
```

**Solution:**
1. Replace old `SpawnSystem` folder with new one
2. Recompile ServUO
3. Files should match version 1.0.0.3

---

## Advanced Configuration

### Custom Spawn Behavior

Edit these in `SpawnSysSettings.cs`:
```csharp
MIN_QUE = 10        // Min spawns queued before processing
UpdateStats()       // Player count spawn multiplier
```

### Performance Tuning

Edit in editor Settings:
- **Max Mob:** Creatures per spawn area
- **Max Crowd:** Total creatures in area
- **Spawn Chances:** Probability adjustments

### Special NPCs

Server includes predefined special NPCs:
- **TownNPC** - Random citizens
- **WorldNPC** - Road travelers
- **AmbushNPC** - Brigand ambush trigger
- **EffectNPCs** - Tile-reactive damage/healing

Add these from the editor's bestiary.

---

## Statistics & Heatmap

### Spawn Statistics

Saved to: `Data\UOR_Stats\YYYY_DDD.txt`  
Format: `Time|CreatureName|MapID|PlayerX|PlayerY|SpawnX|SpawnY`

### Viewing in Editor

1. Ensure stats files exist in `ServUO\Data\UOR_Stats\`
2. Open Map Spawn in editor
3. Toggle **Spawns** button (green = on)
4. See heatmap of spawn activity

### Manual Push

Use `[PushRespawnStats` to save current statistics immediately (forces world save).

---

## Support

### Console Messages

The spawn system outputs colored console messages:
- ?? **Green:** Success operations
- ?? **Yellow:** Warnings and info
- ?? **Red:** Errors

### Common Issues

Refer to the [Troubleshooting](#troubleshooting) section above.

### Getting Help

- **Wilson (Creator):** [www.servuo.dev/members/wilson.12169](https://www.servuo.dev/members/wilson.12169)
- **ServUO Forums:** [www.servuo.com](https://www.servuo.com)

---

## Summary

1. ? Copy `SpawnSystem` to `Scripts/Custom/`
2. ? Compile ServUO
3. ? Generate lists with commands
4. ? Use editor to create spawns
5. ? Use `[ReloadRespawn` to update
6. ? Use `[TrackRespawn` to monitor
7. ? Enjoy dynamic spawning!

**UORespawn transforms your world with player-centric dynamic spawns! ??**
