@inherits LayoutComponentBase
@inject DebugService DebugService
@inject ViewService ViewService
@using UORespawnApp.Scripts.Services
@using UORespawnApp.Scripts.Utilities
@implements IDisposable

<LoadingIndicator />
<ToastNotification />

@{
    // Hide debug panel on home page (splash screen)
    var showDebugPanel = DebugService.IsEnabled && ViewService.CurrentView != "home";
}

<div class="page @(showDebugPanel ? (isDebugCollapsed ? "debug-mode-collapsed" : "debug-mode") : "")">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <article class="content px-4">
            @Body
        </article>
    </main>

    @if (showDebugPanel)
    {
        <DebugPanel OnCollapseChanged="OnDebugCollapseChanged" />
    }
</div>

@code {
    private bool isDebugCollapsed = false;

    protected override void OnInitialized()
    {
        DebugService.OnDebugModeChanged += OnDebugModeChanged;
        ViewService.OnViewChanged += OnViewChanged;
    }

    private void OnDebugModeChanged(bool enabled)
    {
        InvokeAsync(StateHasChanged);
    }

    private void OnViewChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    private void OnDebugCollapseChanged(bool collapsed)
    {
        isDebugCollapsed = collapsed;
        StateHasChanged();
    }

    public void Dispose()
    {
        DebugService.OnDebugModeChanged -= OnDebugModeChanged;
        ViewService.OnViewChanged -= OnViewChanged;
    }
}
