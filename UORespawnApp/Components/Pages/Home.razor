@page "/"

@inject ViewService ViewService

@implements IDisposable

<PageTitle>UORespawn Editor</PageTitle>

@if (ViewService.CurrentView == "home")
{
    <div style="position: fixed; top: 0; left: 250px; right: 0; bottom: 0; background-image: url('splash.png'); background-size: cover; background-position: center; background-repeat: no-repeat; z-index: 0;">
    </div>
    <a href="http://blackboxprogramming.runasp.net" target="_blank" style="position: fixed; bottom: 16px; right: 32px; z-index: 10;" title="Black Box Programming">
        <span class="bi bi-box-fill" style="font-size: 50px; color: black;"></span>
    </a>
}
else if (ViewService.CurrentView == "boxspawn" || ViewService.CurrentView == "mapview") // Support both for backward compatibility
{
    <BoxSpawnComponent @key="ViewService.CurrentMapId.ToString()" />
}
else if (ViewService.CurrentView == "tilespawn" || ViewService.CurrentView == "worldspawn") // Support both old/new
{
    <TileSpawnComponent @key="ViewService.CurrentMapId.ToString()" />
}
else if (ViewService.CurrentView == "regionspawn")
{
    <RegionSpawnComponent @key="ViewService.CurrentMapId.ToString()" />
}
else if (ViewService.CurrentView == "settings")
{
    <SettingsComponent />
}
else if (ViewService.CurrentView == "instructions")
{
    <InstructionsComponent />
}
else if (ViewService.CurrentView == "spawnpacks")
{
    <SpawnPacksComponent />
}

@code {
    protected override void OnInitialized()
    {
        ViewService.OnViewChanged += StateHasChanged;
        ViewService.OnMapChanged += StateHasChanged;
        
        // MauiProgram already initialized session and loaded all data
        // Just log the component initialization
        try
        {
            var totalSpawns = Utility.BoxSpawns.Values.Sum(list => list.Count);
            Logger.Info($"Home component initialized - {totalSpawns} total spawn boxes loaded");
        }
        catch (Exception ex)
        {
            Logger.Error("Error in Home.OnInitialized", ex);
        }
        
        // Default to home view on startup
        if (string.IsNullOrEmpty(ViewService.CurrentView))
        {
            ViewService.SetView("home");
        }
    }

    public void Dispose()
    {
        ViewService.OnViewChanged -= StateHasChanged;
        ViewService.OnMapChanged -= StateHasChanged;
    }
}
